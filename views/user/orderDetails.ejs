<%- include('../../views/partials/user/header') %>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<div class="container my-5">
  <h2 class="text-center mb-4">Order Details</h2>
  <div class="card shadow-sm">
    <div class="card-body">
      <strong>Order ID:</strong> <%= order._id %><br>
      <strong>Order Date:</strong> <%= order.orderDateFormatted %><br>
      <strong>Expected Delivery:</strong> <%= order.expectedDeliveryDateFormatted %>
      <hr>
      <!-- Progress bar -->
      <div class="d-flex align-items-center mb-2">
        <% let stages = ['Order Placed','Packed','Shipped','Out for Delivery','Delivered']; %>
        <% stages.forEach((stage, i) => { %>
          <div class="flex-fill text-center">
            <i class="bi bi-dot <%= i <= order.statusIndex ? 'text-success' : 'text-secondary' %>"></i>
            <div class="small" style="color: <%= i <= order.statusIndex ? '#388e3c' : '#bdbdbd' %>"><%= stage %></div>
          </div>
        <% }) %>
      </div>
      <hr>
      <h5>Items</h5>
      <% order.items.forEach(item => { %>
        <div class="row align-items-center mb-2">
          <div class="col-auto">
            <img src="<%= item.image %>" style="width:60px;height:80px;object-fit:cover;" class="rounded">
          </div>
          <div class="col">
            <div><strong><%= item.name %></strong></div>
            <span class="small text-muted"><%= item.author %></span><br>
            <span class="badge bg-dark"><%= item.coverType %></span>
            <div class="small">Qty: <%= item.quantity %></div>
          </div>
          <div class="col-auto text-end fs-5 fw-bold">₹ <%= item.totalPrice %>/-</div>
        </div>
      <% }) %>
      <hr>
      <h5>Delivery Address</h5>
      <div class="border rounded p-3 mb-4">
        <strong><%= order.address.name %></strong> (<%= order.address.addressType %>)<br>
        <%= order.address.phone %><br>
        <%= order.address.streetAddress %>, <%= order.address.city %>, <%= order.address.state %> - <%= order.address.pinCode %>
      </div>
      <div class="row mb-2">
        <div class="col">Subtotal:</div>
        <div class="col text-end">₹ <%= order.subtotal %>/-</div>
      </div>
      <div class="row mb-2">
        <div class="col">Delivery Charge:</div>
        <div class="col text-end">₹ <%= order.shippingCharge %>/-</div>
      </div>
      <div class="row mb-2">
        <div class="col">Discount:</div>
        <div class="col text-end text-success">-₹ <%= order.discount %>/-</div>
      </div>
      <div class="row border-top pt-2">
        <div class="col fw-bold">Total:</div>
        <div class="col text-end fw-bold">₹ <%= order.finalAmount %>/-</div>
      </div>
    </div>
  </div>
</div>
<%- include('../../views/partials/user/footer') %>

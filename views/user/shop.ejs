<%- include('../../views/partials/user/header') %>

<div class="container-fluid">
  <div class="row">
    
    <!-- Sidebar Filters -->
    <aside class="col-md-3 col-lg-2 mb-4">
      <div class="card shadow-sm border-0 p-3">
        <h5 class="mb-3">Filters</h5>

        <form action="/filter" >
        <!-- Category Filter -->
        <h6 class="fw-semibold">Categories</h6>
        <% for (let i=0; i<category.length; i++) { %>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" name="category" value="<%=category[i].name%>">
          <label class="form-check-label" for="fiction"><%=category[i].name%></label>
        </div>
        <%}%>

        <!-- Price Filter -->
        <h6 class="fw-semibold">Price Range</h6>
<div class="form-check">
  <input class="form-check-input" type="radio" name="priceRange" value="100-200" id="p1"
    <%= selectedPriceRange === "100-200" ? "checked" : "" %>>
  <label class="form-check-label" for="p1">₹100 - ₹200</label>
</div>
<div class="form-check">
  <input class="form-check-input" type="radio" name="priceRange" value="200-400" id="p2"
    <%= selectedPriceRange === "200-400" ? "checked" : "" %>>
  <label class="form-check-label" for="p2">₹200 - ₹400</label>
</div>
<div class="form-check">
  <input class="form-check-input" type="radio" name="priceRange" value="400-700" id="p3"
    <%= selectedPriceRange === "400-700" ? "checked" : "" %>>
  <label class="form-check-label" for="p3">₹400 - ₹700</label>
</div>
<div class="form-check">
  <input class="form-check-input" type="radio" name="priceRange" value="700-1000" id="p4"
    <%= selectedPriceRange === "700-1000" ? "checked" : "" %>>
  <label class="form-check-label" for="p4">₹700 - ₹1000</label>
</div>
<div class="form-check mb-3">
  <input class="form-check-input" type="radio" name="priceRange" value="1000+" id="p5"
    <%= selectedPriceRange === "1000+" ? "checked" : "" %>>
  <label class="form-check-label" for="p5">Above ₹1000</label>
</div>

        <!-- Buttons -->
        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-sm btn-primary">Apply</button>
          <button class="btn btn-sm btn-outline-secondary">Clear</button>
        </div>
        </form>
      </div>
    </aside>

    <!-- Products Listing -->
    <main class="col-md-9 col-lg-10">

      <!-- Sort Options -->
      <div class="d-flex justify-content-end mb-3">
        <select class="form-select w-auto">
          <option disabled selected>Sort by</option>
          <option value="low-high">Price: Low to High</option>
          <option value="high-low">Price: High to Low</option>
          <option value="az">aA - zZ</option>
          <option value="za">zZ - aA</option>
        </select>
      </div>

      <!-- Search info -->
  <% if (searchQuery) { %>
    <h5 class="mb-4">Search results for: "<%= searchQuery %>"</h5>
  <% } %>

      <!-- Product Grid -->
      <div class="row g-4">
        <% books.forEach(book => { %>
          <div class="col-lg-3 col-md-4 col-sm-6">
            <div class="card h-100 shadow-sm border-0">
              
                            <!-- Image (keep aspect 2:3 without relying on custom classes) -->
              <a class="d-block" href="/productDetails?id=<%= book._id %>" aria-label="<%= book.name %>" style="aspect-ratio: 2 / 3;">
                <img
                  src="<%= (book.images && book.images.length > 0) ? book.images[0] : '/placeholder.svg?height=600&width=400' %>"
                  alt="<%= book.name %>"
                  class="card-img-top object-fit-cover w-100 h-100"
                  style="object-fit: cover;"
                >
              </a>

              <div class="card-body d-flex flex-column">
                
                <!-- Author -->
                <h6 class="card-subtitle text-muted mb-1"><%= book.author %></h6>
                
                <!-- Title -->
                <h5 class="card-title mb-2">
                  <a href="/products/<%= book._id %>" class="text-dark text-decoration-none"><%= book.name %></a>
                </h5>

                <!-- Price -->
                <% const paperback = book.variants[0]; %>
                <div class="mb-2">
                  <% if (paperback && paperback.originalPrice > paperback.discountPrice) { %>
                    <span class="text-danger fw-bold me-2">₹<%= paperback.discountPrice %></span>
                    <span class="text-muted text-decoration-line-through">₹<%= paperback.originalPrice %></span>
                  <% } else if (paperback) { %>
                    <span class="fw-semibold">₹<%= paperback.originalPrice %></span>
                  <% } %>
                </div>

                <!-- Rating -->
                <div class="mb-2">
                  <% const rating = Math.floor(Math.random() * 2) + 4; %>
                  <% for (let i = 1; i <= 5; i++) { %>
                    <% if (i <= rating) { %>
                      <i class="bi bi-star-fill text-warning"></i>
                    <% } else { %>
                      <i class="bi bi-star text-warning"></i>
                    <% } %>
                  <% } %>
                  <span class="small text-muted ms-1">(3.6k)</span>
                </div>

                <!-- Buttons -->
                <div class="mt-auto d-flex gap-2">
                  <form action="/cart" method="post">
                    <input type="hidden" name="productId" value="<%= book._id %>">
                    <button class="btn btn-sm btn-primary" type="submit" <%= book.variants[0].stock <= 0 ? 'disabled' : '' %>>
                      <i class="bi bi-cart-plus"></i>
                    </button>
                  </form>
                  <button class="btn btn-sm btn-outline-secondary" type="button" data-wishlist="<%= book._id %>">
                    <i class="bi bi-heart"></i>
                  </button>
                </div>

                <% if (book.variants[0].stock <= 0) { %>
                  <span class="badge text-bg-secondary mt-2">Out of stock</span>
                <% } %>
              </div>
            </div>
          </div>
        <% }) %>
      </div>
    </main>
  </div>
</div>

<%- include('../../views/partials/user/footer') %>

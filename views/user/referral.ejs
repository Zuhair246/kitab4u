<%- include('../../views/partials/user/header') %>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">

<main class="py-5">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 col-lg-10 col-xl-8">

        <!-- Page Title -->
        <div class="text-center mb-5">
          <h1 class="display-5 fw-bold text-dark mb-3">Refer a Friend & Earn</h1>
          <p class="lead text-muted px-md-5">
            Share your code with friends and you'll both get rewards! <br> when they Signup using your Referral Code <br> You will ₹100 and they will get ₹50 in wallet.
          </p>
        </div>

        <!-- Referral Code Card -->
<div class="card shadow-lg border-0 rounded-4 overflow-hidden">
  <div class="card-body p-5 p-md-5">
    <div class="row align-items-center g-5">
      
      <!-- Left: Referral Code -->
      <div class="col-12 col-md-6 text-center text-md">
        <h4 class="fw-bold mb-3">Your Unique Referral Code</h4>
        
        <div class="d-flex flex-column flex-sm-row align-items-center gap-3">
          <!-- Referral Code Box - Always in one line -->
          <div class="bg-primary bg-opacity-10 text-primary px-5 py-3 rounded-3 fw-bold fs-4 tracking-widest border border-primary border-3 text-center"
               style="font-family: 'Courier New', monospace; letter-spacing: 0.3em; min-width: 280px;">
            <%= user.referralCode || null %>
          </div>

          <!-- Copy Button -->
          <button class="btn btn-primary btn-lg d-flex align-items-center gap-2 shadow-sm" onclick="copyReferralCode()">
            <i class="bi bi-copy"></i>
            <span class="d-none d-sm-inline">Copy</span>
          </button>
        </div>

        <hr class="my-5 d-block d-md-none">

        <!-- Share Buttons -->
        <div class="d-flex justify-content-center justify-content-md-start gap-3 mt-4 flex-wrap">
          <a href="https://wa.me/?text=Signup%20in%20KITAB4U%20and%20get%20₹50%20in%20your%20wallet%20as%20Welcome%20offer!%20Use%20my%20referral%20code%3A%20<%= user.referralCode || 'REF1234567' %>"
             target="_blank" class="btn btn-success d-flex align-items-center gap-2 px-4">
            <i class="bi bi-whatsapp fs-4"></i>
            <span class="d-none d-sm-inline">WhatsApp</span>
          </a>
          <a href="mailto:?subject=Join%20KITAB4U%20with%20my%20referral!&body=Hey!%20Use%20my%20referral%20code%20<%= user.referralCode || 'REF1234567' %>%20to%20get%20a%20discount%20on%20your%20first%20purchase!"
             class="btn btn-outline-secondary d-flex align-items-center gap-2 px-4">
            <i class="bi bi-envelope fs-4"></i>
            <span class="d-none d-sm-inline">Email</span>
          </a>
        </div>
      </div>

      <!-- Right: Illustration -->
      <!-- <div class="col-12 col-md-6 text-center">
        <img src="https://images.unsplash.com/photo-1556742111-a22f18684f52?w=500&h=500&fit=crop&crop=center"
             alt="Friends sharing referral"
             class="img-fluid rounded-4 shadow"
             style="max-height: 380px; object-fit: cover;">
      </div> -->
    </div>
  </div>
</div>

        <!-- How It Works Section -->
        <div class="mt-5">
          <h2 class="text-center fw-bold mb-5">How It Works</h2>
          <div class="row g-4 g-lg-5">
            <!-- Step 1 -->
            <div class="col-12 col-md-4">
              <div class="text-center">
                <div class="bg-primary bg-opacity-10 text-primary rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                  <i class="bi bi-share fs-2"></i>
                </div>
                <h5 class="fw-bold">Share Your Code</h5>
                <p class="text-muted small">Send your unique referral code to friends and family via WhatsApp, email, or any platform.</p>
              </div>
            </div>
            <!-- Step 2 -->
            <div class="col-12 col-md-4">
              <div class="text-center">
                <div class="bg-primary bg-opacity-10 text-primary rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                  <i class="bi bi-person-plus fs-2"></i>
                </div>
                <h5 class="fw-bold">They Sign Up</h5>
                <p class="text-muted small">Your friend creates an account on KITAB4U using your referral code during signup.</p>
              </div>
            </div>
            <!-- Step 3 -->
            <div class="col-12 col-md-4">
              <div class="text-center">
                <div class="bg-primary bg-opacity-10 text-primary rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                  <i class="bi bi-gift fs-2"></i>
                </div>
                <h5 class="fw-bold">Both Get Rewarded!</h5>
                <p class="text-muted small">You both receive store credit once they complete their first purchase. Win-win!</p>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</main>

<%- include('../../views/partials/user/footer') %>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
function copyReferralCode() {
  const code = "<%= user.referralCode || 'REF1234567' %>";
  navigator.clipboard.writeText(code).then(() => {
    const btn = event.target.closest('button');
    const original = btn.innerHTML;
    btn.innerHTML = '<i class="bi bi-check-circle-fill"></i> Copied!';
    btn.classList.replace('btn-primary', 'btn-success');
    setTimeout(() => {
      btn.innerHTML = original;
      btn.classList.replace('btn-success', 'btn-primary');
    }, 2000);
  }).catch(() => {
    Swal.fire({
        icon:'error',
        title: 'Failed!',
        text: "Failed to copy your referral code"
    })
  });
}
</script>

<style>
  /* Smooth hover effect for cards */
  .card:hover {
    transform: translateY(-5px);
    transition: transform 0.3s ease;
  }
  @media (max-width: 576px) {
    .display-5 {
      font-size: 2rem;
    }
  }
</style>